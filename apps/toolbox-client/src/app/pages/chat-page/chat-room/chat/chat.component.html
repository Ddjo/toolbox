

<div class="chat-header flex justify-content-between align-items-center		">

    <span class="user">connected as {{memberInput().email}}</span>
    <div>
        <p-button 
            *ngIf="currentUser()?.email !== memberInput()?.email" 
            icon="pi pi-sign-out" 
            aria-label="Leave" 
            [outlined]="false" 
            [rounded]="false" 
            [text]="true"
            (click)="memberLeavesChatOutput.emit(this.memberInput())" 
            size="small" 
        />
    </div>

</div>

<div class="chat-messages flex flex-column pt-3">

    <p-button (onClick)="loadOlderMessages()">load older messages</p-button>
    <cdk-virtual-scroll-viewport #messagesViewport
        appendOnly
        [itemSize]="50"  
        [minBufferPx]="300"  
        [maxBufferPx]="500"  
        class="messages-viewport p-1 gap-1" 
        (scrolledIndexChange)="messagesViewportScrolling($event)"
    >
        <!-- <div *cdkVirtualFor="let message of (filteredMessages$ | async)" class="example-item"> -->
            <app-chat-message 
                *cdkVirtualFor="let message of filteredMessages$"
                [appCdkDynamicHeightDir]="message"
                [isSenderCurrentUserInput]="message.sender._id === memberInput()._id"
                [messageInput]="message"
                [displayUserMailInput]="message.displayEmail"
            />
        <!-- </div> -->
    </cdk-virtual-scroll-viewport>

    <!-- <p-virtualscroller
        #sc
        [items]="(filteredMessages$ | async)"
        [options]="scrollerOptions"
        [lazy]="false"
        [scrollHeight]="'18rem'"
        styleClass="border border-surface"
        >
            <ng-template pTemplate="item" let-item let-options="options">
                <app-chat-message 
                [isSenderCurrentUserInput]="item.sender._id === memberInput()._id"
                [messageInput]="item"
                [displayUserMailInput]="item.displayEmail"
            />
            </ng-template>
    </p-virtualscroller> -->

    <!-- <p-button label="Reset" (click)="reset()" /> -->
    <!-- <p-virtualscroller
        #sc
        [items]="items"
        [itemSize]="18"
        [lazy]="false"
        scrollHeight="200px"
        styleClass="border border-surface"
        class="full-height-scroller"
        [style]="{'width': '200px', 'height': '200px'}">
            <ng-template pTemplate="item" let-item let-options="options">
                <div
                class="flex items-center"
                [ngClass]="{ 'bg-surface-100 dark:bg-surface-700': options.odd }"
                style="height: 18px;">
                    {{ item }}
                </div>
            </ng-template>
    </p-virtualscroller> -->

    <div  class="typing-message flex align-items-end pl-2 pb-1">
        <span *ngIf="(typingUsersWithoutCurrentMember().length === 1)">{{typingUsersWithoutCurrentMember()[0]}} is typing...</span>
        <span *ngIf="(typingUsersWithoutCurrentMember().length > 1)">{{typingUsersWithoutCurrentMember()[0]}} and {{typingUsersWithoutCurrentMember().length - 1}} more are typing... </span>
    </div>
        
</div>


<div class="new-messages-tooltip flex align-items-center justify-content-center" *ngIf="unreadMessages > 0">
     <p-button icon="pi pi-arrow-down" size="small" label="New messages" (onClick)="scrollToLastMessage('smooth')" [badge]="unreadMessages.toString()" />
</div>


<div class="chat-input flex flex-row align-items-center">

    <input 
        pSize="small" 
        class="mr-2"
        pInputText             
        [formControl]="messageContent"
        placeholder="Type your message..."
        (keyup.enter)="sendMessage()"

        >
    <p-button 
        icon="pi pi-send"
        size="small" 
        [outlined]="false" 
        [rounded]="false" 
        [text]="true"
        [disabled]="!messageContent.value"
        (click)="sendMessage()"
    />
</div>
