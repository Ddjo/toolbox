

<div class="chat-header flex justify-content-between align-items-center		">

    <span class="user">connected as {{memberInput().email}}</span>
    <div>
        <p-button 
            *ngIf="currentUser()?.email !== memberInput()?.email" 
            icon="pi pi-sign-out" 
            aria-label="Leave" 
            [outlined]="false" 
            [rounded]="false" 
            [text]="true"
            (click)="memberLeavesChatOutput.emit(this.memberInput())" 
            size="small" 
        />
    </div>

</div>

<!-- <p-button (onClick)="loadOlderMessages()">load older messages</p-button> -->
<!-- <p-button (onClick)="scrollTo9()">scroll to 9</p-button> -->
<p-button (onClick)="setFirstMessageAsSeen()">set first message as seen</p-button>

<div class="chat-messages flex flex-column pt-3">

    <cdk-virtual-scroll-viewport #messagesViewport
        appendOnly
        [minBufferPx]="500" 
        [maxBufferPx]="1000" 
        [itemSize]="40"
        class="messages-viewport p-1 gap-1" 
        (scrolledIndexChange)="scrollingIndexChanged($event)"
    >
        <div class="flex align-items-center justify-content-center" *ngIf="loadingMessages()">
            <p-progress-spinner  ariaLabel="loading" />
        </div>

        <app-chat-message #messageElement
            *cdkVirtualFor="let message of filteredMessages$"
            [isSenderCurrentUserInput]="message.sender._id === memberInput()._id"
            [messageInput]="message"
            [displayUserMailInput]="message.displayEmail"
        />
    </cdk-virtual-scroll-viewport>

    <div  class="typing-message flex align-items-end pl-2 pb-1">
        <span *ngIf="(typingUsersWithoutCurrentMember().length === 1)">{{typingUsersWithoutCurrentMember()[0]}} is typing...</span>
        <span *ngIf="(typingUsersWithoutCurrentMember().length > 1)">{{typingUsersWithoutCurrentMember()[0]}} and {{typingUsersWithoutCurrentMember().length - 1}} more are typing... </span>
    </div>
        
</div>


<div class="new-messages-tooltip flex align-items-center justify-content-center" *ngIf="unreadMessages > 0">
     <p-button icon="pi pi-arrow-down" size="small" label="New messages" (onClick)="scrollToLastMessage('smooth')" [badge]="unreadMessages.toString()" />
</div>


<div class="chat-input flex flex-row align-items-center">

    <input 
        pSize="small" 
        class="mr-2"
        pInputText             
        [formControl]="messageContent"
        placeholder="Type your message..."
        (keyup.enter)="sendMessage()"

        >
    <p-button 
        icon="pi pi-send"
        size="small" 
        [outlined]="false" 
        [rounded]="false" 
        [text]="true"
        [disabled]="!messageContent.value"
        (click)="sendMessage()"
    />
</div>
